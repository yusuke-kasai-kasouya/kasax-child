# kasax_child : 検索ロジック・ユニット (Laravelバックエンド)

本ディレクトリには、創作支援システム『kasax_child』の動作を補完し、高度なデータ処理を担うLaravelバックエンドのコードを格納しています。

## 設計の根幹：ハイブリッド・アーキテクチャ

本システムは、WordPressを「データストレージ（DB）」として利用しつつ、複雑な計算や検索処理のみをLaravelへ切り離した**疎結合（デカップリング）設計**を採用しています。

* **Laravelの役割**: WordPress側では負荷が高い検索ロジックを実行する専用エンジン。
* **非依存性**: WordPressテーマ本体は独立して動作可能です。本ユニットを接続することで、より高速かつ柔軟なナレッジ検索が有効化されます。

---

### 1. コンポーネント解説

#### **A. 検索エンジン（Service & Repository層）**
システムの最重要ロジックです。
* **`KxKnowledgeSearchService.php`**: 1万件超のナレッジを扱うための心臓部。キーワード、タクソノミー（カテゴリ・タグ）による包含・除外判定、正規表現を用いたテキスト整形など、ビジネスロジックを一手に引き受けます。
* **`KxPostRepository.php`**: データの取得元をWordPressの `wp_posts` テーブルに特化させたデータアクセス層。Laravel標準のDB機能（クエリビルダ）を使い、WPの標準機能（WP_Query等）では到達しにくい柔軟なデータ抽出を実現します。

#### **B. APIゲートウェイ（Controller層）**
WordPressテーマとの通信窓口です。
* **`KxSearchApiController.php`**: WordPress側からのリクエストをJSON形式で受け取り、検索結果を返却します。タイトル完全一致によるID特定、階層構造の解析など、フロントエンドが必要とする特定のデータ形式に加工して配信します。
* **`IpLimitMiddleware.php`**: APIアクセス制限。許可されたIPアドレス（WordPress稼働サーバー等）以外からのアクセスを遮断し、ナレッジデータの不正取得を防止します。

#### **C. 検索シミュレーター（Web & Blade）**
APIとしてではなく、Laravel単体で検索結果を確認するためのUIキットです。
* **`search_form.blade.php` / `search_results.blade.php`**: 実際のサービス層（SearchService）を直接呼び出し、検索ロジックの挙動を視覚的にテスト・確認するためのインターフェースを提供します。

---

### 2. 未来の拡張性
現在は検索が主目的ですが、この構造により「Laravel側でAIによる文章解析を行う」「複雑なプロットの矛盾をDBレベルで検知する」といった、重い処理を伴う機能をいつでも追加できる**「創作支援エンジンの拡張スロット」**として機能します。

---

### コミュニケーションについて
制作者は日本語を母国語としています。英語での問い合わせも翻訳ツールを介して対応可能ですが、日本語でいただけるとよりスムーズな回答が可能です。

> **Note:** 本ドキュメントは、内部コード構造を正確に反映するためAI（Gemini）の支援を受けて作成されました。